<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê¸°ë…ì¼ ì˜ìƒ â€” ë¶€ëª¨ë‹˜ì˜ ìˆœê°„ì„ ì‚´ì•„ ì›€ì§ì´ê²Œ</title>
<meta name="description" content="ì†Œì¤‘í•œ ê°€ì¡± ì‚¬ì§„ì„ AIë¡œ ì‚´ì•„ ì›€ì§ì´ëŠ” ê°ë™ ì˜ìƒìœ¼ë¡œ. í™˜ê°‘Â·ì¹ ìˆœÂ·ê²°í˜¼ê¸°ë…ì¼ í–‰ì‚¬ì—ì„œ ë°”ë¡œ ìƒì˜ ê°€ëŠ¥í•œ 16:9 í”„ë¦¬ë¯¸ì—„ ì¸ìƒ ì˜ìƒ.">
<script src="https://cdn.portone.io/v2/browser-sdk.js"></script>
<style>
:root {
  --purple: #a78bfa;
  --purple-dark: #7c3aed;
  --green: #34d399;
  --bg: #0f0f14;
  --card: #1a1a2e;
  --border: #2d2d44;
  --text: #e2e8f0;
  --muted: #94a3b8;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Noto Sans KR', sans-serif;
       background: var(--bg); color: var(--text); line-height: 1.6; }

/* â”€â”€ Hero â”€â”€ */
.hero { min-height: 100vh; display: flex; flex-direction: column;
        align-items: center; justify-content: center; text-align: center;
        padding: 60px 20px; position: relative; overflow: hidden; }
.hero::before { content: '';position:absolute;inset:0;
  background: radial-gradient(ellipse 80% 60% at 50% 0%, #3b1d6e33, transparent);
  pointer-events: none; }
.hero-tag { background: #2d1b4e; color: var(--purple); padding: 6px 16px;
            border-radius: 20px; font-size: 13px; font-weight: 600;
            letter-spacing: .5px; margin-bottom: 24px; display: inline-block; }
.hero h1 { font-size: clamp(28px, 6vw, 52px); font-weight: 800; line-height: 1.2;
           margin-bottom: 20px; }
.hero h1 span { color: var(--purple); }
.hero-sub { font-size: clamp(15px, 2.5vw, 18px); color: var(--muted);
            max-width: 520px; margin: 0 auto 40px; }
.cta-btn { background: var(--purple-dark); color: #fff; border: none; cursor: pointer;
           padding: 16px 40px; border-radius: 12px; font-size: 17px; font-weight: 700;
           letter-spacing: .3px; transition: transform .2s, box-shadow .2s;
           box-shadow: 0 0 30px #7c3aed44; }
.cta-btn:hover { transform: translateY(-2px); box-shadow: 0 0 40px #7c3aed66; }
.price-hint { margin-top: 14px; font-size: 14px; color: var(--muted); }
.price-hint strong { color: var(--green); font-size: 18px; }

/* â”€â”€ íŠ¹ì§• â”€â”€ */
.features { padding: 80px 20px; max-width: 1000px; margin: 0 auto; }
.section-title { text-align: center; font-size: clamp(22px, 4vw, 32px);
                 font-weight: 700; margin-bottom: 48px; }
.feature-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; }
.feature-card { background: var(--card); border: 1px solid var(--border); border-radius: 16px;
                padding: 28px 24px; text-align: center; transition: border-color .2s; }
.feature-card:hover { border-color: #a78bfa44; }
.feature-icon { font-size: 36px; margin-bottom: 14px; }
.feature-card h3 { font-size: 16px; font-weight: 700; margin-bottom: 8px; }
.feature-card p { font-size: 14px; color: var(--muted); line-height: 1.6; }

/* â”€â”€ í”„ë¡œì„¸ìŠ¤ â”€â”€ */
.process { padding: 80px 20px; background: #13131f; }
.process-inner { max-width: 700px; margin: 0 auto; }
.steps { display: flex; flex-direction: column; gap: 20px; margin-top: 40px; }
.step { display: flex; align-items: flex-start; gap: 20px; }
.step-num { width: 40px; height: 40px; border-radius: 50%; background: var(--purple-dark);
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 16px; flex-shrink: 0; }
.step-content h4 { font-size: 16px; font-weight: 700; margin-bottom: 4px; }
.step-content p { font-size: 14px; color: var(--muted); }

/* â”€â”€ ì£¼ë¬¸ í¼ â”€â”€ */
.order-section { padding: 80px 20px; max-width: 560px; margin: 0 auto; }
.order-card { background: var(--card); border: 1px solid var(--border);
              border-radius: 20px; padding: 36px; }
.order-card h2 { font-size: 22px; font-weight: 700; margin-bottom: 8px; }
.order-card .sub { font-size: 14px; color: var(--muted); margin-bottom: 28px; }
.form-group { margin-bottom: 18px; }
.form-group label { font-size: 13px; font-weight: 600; color: var(--muted);
                    margin-bottom: 6px; display: block; }
.form-group input, .form-group select {
  width: 100%; background: #0f0f14; border: 1px solid var(--border);
  color: var(--text); padding: 11px 14px; border-radius: 8px;
  font-size: 15px; outline: none; transition: border-color .2s; }
.form-group input:focus, .form-group select:focus { border-color: var(--purple); }
.form-group input::placeholder { color: #4a5568; }
.form-error { font-size: 12px; color: #f87171; margin-top: 4px; display: none; }
.price-box { background: #13131f; border-radius: 12px; padding: 18px;
             margin: 24px 0; display: flex; justify-content: space-between; align-items: center; }
.price-box .label { font-size: 14px; color: var(--muted); }
.price-box .amount { font-size: 24px; font-weight: 800; color: var(--green); }
.submit-btn { width: 100%; background: var(--purple-dark); color: #fff; border: none;
              padding: 15px; border-radius: 10px; font-size: 16px; font-weight: 700;
              cursor: pointer; transition: opacity .2s; }
.submit-btn:hover { opacity: .9; }
.submit-btn:disabled { opacity: .5; cursor: not-allowed; }
.notice { font-size: 12px; color: #4a5568; text-align: center; margin-top: 12px; line-height: 1.8; }

/* â”€â”€ ê°œë°œìš© ë²„íŠ¼ â”€â”€ */
.dev-btn { width: 100%; background: transparent; color: #f59e0b;
           border: 1px dashed #f59e0b; padding: 11px; border-radius: 10px;
           font-size: 13px; font-weight: 600; cursor: pointer; margin-top: 10px;
           transition: background .2s; }
.dev-btn:hover { background: #f59e0b18; }
.dev-btn:disabled { opacity: .4; cursor: not-allowed; }
.dev-banner { background: #1c1500; border: 1px solid #f59e0b44; border-radius: 8px;
              padding: 8px 14px; font-size: 12px; color: #f59e0b;
              text-align: center; margin-bottom: 20px; }

/* â”€â”€ ì—…ë¡œë“œ ë‹¨ê³„ â”€â”€ */
.upload-section { display: none; padding: 80px 20px; max-width: 560px; margin: 0 auto; }
.upload-card { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 36px; }
.upload-card h2 { font-size: 20px; font-weight: 700; margin-bottom: 8px; }
.progress-bar { height: 6px; background: var(--border); border-radius: 3px; margin: 20px 0; overflow: hidden; }
.progress-fill { height: 100%; background: var(--purple); border-radius: 3px;
                 transition: width .4s; width: 0%; }
.upload-drop { border: 2px dashed var(--border); border-radius: 12px;
               padding: 40px; text-align: center; cursor: pointer;
               transition: border-color .2s; margin-bottom: 16px; }
.upload-drop:hover, .upload-drop.drag-over { border-color: var(--purple); background: #1e1b4b22; }
.upload-drop p { color: var(--muted); font-size: 14px; margin-top: 8px; }
#file-input { display: none; }
.file-list { display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px; max-height: 260px; overflow-y: auto; }
.file-item { display: flex; align-items: center; gap: 10px; background: #13131f;
             padding: 8px 12px; border-radius: 8px; font-size: 13px; }
.file-item .file-name { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.file-item .file-status { font-size: 12px; color: var(--green); flex-shrink: 0; }
.file-item .file-status.uploading { color: var(--purple); }
.file-item .file-status.error { color: #f87171; }
.upload-start-btn { width: 100%; background: var(--purple-dark); color: #fff; border: none;
                    padding: 14px; border-radius: 10px; font-size: 15px; font-weight: 700;
                    cursor: pointer; transition: opacity .2s; }
.upload-start-btn:disabled { opacity: .5; cursor: not-allowed; }

/* â”€â”€ ì™„ë£Œ â”€â”€ */
.done-section { display: none; padding: 80px 20px; max-width: 480px; margin: 0 auto; text-align: center; }
.done-icon { font-size: 64px; margin-bottom: 24px; }
.done-section h2 { font-size: 24px; font-weight: 700; margin-bottom: 12px; }
.done-section p { color: var(--muted); font-size: 15px; line-height: 1.8; }
.order-number { background: var(--card); border-radius: 10px; padding: 14px 20px;
                margin: 20px 0; font-size: 16px; font-weight: 600; color: var(--purple); }

/* â”€â”€ í‘¸í„° â”€â”€ */
footer { border-top: 1px solid var(--border); padding: 30px 20px;
         text-align: center; font-size: 13px; color: #4a5568; }

/* â”€â”€ ë°˜ì‘í˜• â”€â”€ */
@media (max-width: 480px) {
  .order-card, .upload-card { padding: 24px 18px; }
}
</style>
</head>
<body>

<!-- Hero -->
<section class="hero">
  <div class="hero-tag">âœ¨ AI ê¸°ë°˜ í”„ë¦¬ë¯¸ì—„ ê¸°ë… ì˜ìƒ</div>
  <h1>ë¶€ëª¨ë‹˜ì˜ ì‚¬ì§„ì´<br><span>ì‚´ì•„ ì›€ì§ì…ë‹ˆë‹¤</span></h1>
  <p class="hero-sub">ì†Œì¤‘í•œ ê°€ì¡± ì‚¬ì§„ì„ AIë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ì›€ì§ì´ëŠ” ê°ë™ ì˜ìƒìœ¼ë¡œ.<br>
    í™˜ê°‘Â·ì¹ ìˆœÂ·ê²°í˜¼ê¸°ë…ì¼ í–‰ì‚¬ì—ì„œ ë°”ë¡œ ìƒì˜í•˜ì„¸ìš”.</p>
  <button class="cta-btn" onclick="scrollToOrder()">ì§€ê¸ˆ ì£¼ë¬¸í•˜ê¸°</button>
  <p class="price-hint">ë‹¨ <strong>29,900ì›</strong> Â· 24ì‹œê°„ ë‚´ ì œì‘ Â· 1080p 16:9</p>
</section>

<!-- íŠ¹ì§• -->
<section class="features">
  <h2 class="section-title">ì™œ ë‹¤ë¥¼ê¹Œìš”?</h2>
  <div class="feature-grid">
    <div class="feature-card">
      <div class="feature-icon">ğŸ­</div>
      <h3>ë‹¨ìˆœ ìŠ¬ë¼ì´ë“œ ì•„ë‹˜</h3>
      <p>AIê°€ ì‚¬ì§„ ì† ì¸ë¬¼ì˜ í‘œì •ê³¼ ë°°ê²½ì„ ë¶„ì„í•´ ìì—°ìŠ¤ëŸ¬ìš´ ì›€ì§ì„ì„ ë§Œë“¤ì–´ëƒ…ë‹ˆë‹¤</p>
    </div>
    <div class="feature-card">
      <div class="feature-icon">ğŸµ</div>
      <h3>ê°ì„± ë°°ê²½ìŒì•…</h3>
      <p>ì˜ìƒ ë¶„ìœ„ê¸°ì— ë§ëŠ” ê°ì„±ì ì¸ ìŒì•…ì´ ìë™ìœ¼ë¡œ ì‚½ì…ë˜ì–´ ê°ë™ì„ ê·¹ëŒ€í™”í•©ë‹ˆë‹¤</p>
    </div>
    <div class="feature-card">
      <div class="feature-icon">ğŸ“½ï¸</div>
      <h3>í–‰ì‚¬ ìƒì˜ ìµœì í™”</h3>
      <p>1920Ã—1080 í’€HD ê°€ë¡œí˜•ìœ¼ë¡œ ì œì‘. ë¹”í”„ë¡œì í„°Â·TV ì–´ë””ì„œë“  ë°”ë¡œ ìƒì˜ ê°€ëŠ¥</p>
    </div>
    <div class="feature-card">
      <div class="feature-icon">âš¡</div>
      <h3>24ì‹œê°„ ë‚´ ì™„ì„±</h3>
      <p>ì£¼ë¬¸ í›„ 24ì‹œê°„ ì´ë‚´ ì™„ì„± ì˜ìƒì„ ë‹¤ìš´ë¡œë“œ ë§í¬ë¡œ ë°”ë¡œ ì „ë‹¬í•´ë“œë¦½ë‹ˆë‹¤</p>
    </div>
  </div>
</section>

<!-- í”„ë¡œì„¸ìŠ¤ -->
<section class="process">
  <div class="process-inner">
    <h2 class="section-title">ì–´ë–»ê²Œ ì§„í–‰ë˜ë‚˜ìš”?</h2>
    <div class="steps">
      <div class="step">
        <div class="step-num">1</div>
        <div class="step-content">
          <h4>ì£¼ë¬¸ & ê²°ì œ (1ë¶„)</h4>
          <p>ì´ë¦„, ì—°ë½ì²˜ ì…ë ¥ í›„ 29,900ì› ê²°ì œ. í† ìŠ¤í˜ì´ë¨¼ì¸ ë¡œ ì•ˆì „í•˜ê²Œ.</p>
        </div>
      </div>
      <div class="step">
        <div class="step-num">2</div>
        <div class="step-content">
          <h4>ì‚¬ì§„ ì—…ë¡œë“œ (5ë¶„)</h4>
          <p>ê°€ì¡± ì‚¬ì§„ 10~15ì¥ ì—…ë¡œë“œ. ì–´ë¦´ ì ë¶€í„° ìµœê·¼ ì‚¬ì§„ê¹Œì§€ ì‹œê°„ ìˆœì„œëŒ€ë¡œ.</p>
        </div>
      </div>
      <div class="step">
        <div class="step-num">3</div>
        <div class="step-content">
          <h4>AI ì œì‘ (24ì‹œê°„ ì´ë‚´)</h4>
          <p>AIê°€ ê° ì‚¬ì§„ì— ìì—°ìŠ¤ëŸ¬ìš´ ì›€ì§ì„ì„ ë§Œë“¤ê³  ìŒì•…ê³¼ í•¨ê»˜ í¸ì§‘í•©ë‹ˆë‹¤.</p>
        </div>
      </div>
      <div class="step">
        <div class="step-num">4</div>
        <div class="step-content">
          <h4>ë¬¸ìë¡œ ë‹¤ìš´ë¡œë“œ ë§í¬ ìˆ˜ë ¹</h4>
          <p>ì™„ì„±ë˜ë©´ ë¬¸ìë¡œ ë‹¤ìš´ë¡œë“œ ë§í¬ë¥¼ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤. 72ì‹œê°„ ë‚´ ë‹¤ìš´ë¡œë“œ.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ì£¼ë¬¸ í¼ -->
<section class="order-section" id="order-section">
  <div class="order-card">
    <h2>ì£¼ë¬¸í•˜ê¸°</h2>
    <p class="sub">ê²°ì œ í›„ ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ì‹œë©´ 24ì‹œê°„ ë‚´ ì™„ì„± ì˜ìƒì„ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.</p>

    <div class="form-group">
      <label>ì´ë¦„ *</label>
      <input type="text" id="customerName" placeholder="í™ê¸¸ë™" maxlength="20">
      <div class="form-error" id="err-name"></div>
    </div>
    <div class="form-group">
      <label>ì—°ë½ì²˜ * (ì™„ì„± ì•Œë¦¼ ìˆ˜ì‹ )</label>
      <input type="tel" id="customerPhone" placeholder="01012345678" maxlength="11">
      <div class="form-error" id="err-phone"></div>
    </div>
    <div class="form-group">
      <label>ì´ë©”ì¼ (ì„ íƒ)</label>
      <input type="email" id="customerEmail" placeholder="example@email.com">
    </div>
    <div class="form-group">
      <label>ì—…ë¡œë“œí•  ì‚¬ì§„ ìˆ˜ *</label>
      <select id="photoCount">
        <option value="10">10ì¥</option>
        <option value="11">11ì¥</option>
        <option value="12" selected>12ì¥ (ì¶”ì²œ)</option>
        <option value="13">13ì¥</option>
        <option value="14">14ì¥</option>
        <option value="15">15ì¥</option>
      </select>
    </div>

    <div class="price-box">
      <div>
        <div class="label">í”„ë¦¬ë¯¸ì—„ ì¸ìƒ ì˜ìƒ 1í¸</div>
        <div style="font-size:12px;color:#4a5568;margin-top:2px">16:9 Â· 1080p Â· 60~90ì´ˆ Â· 24ì‹œê°„ ë‚´</div>
      </div>
      <div class="amount">29,900ì›</div>
    </div>

    <button class="submit-btn" id="pay-btn" onclick="startPayment()">
      ğŸ’³ ê²°ì œí•˜ê³  ì‚¬ì§„ ì—…ë¡œë“œí•˜ê¸°
    </button>

    <!-- ê°œë°œìš© ë²„íŠ¼ â€” ë¡œì»¬ì—ì„œë§Œ ë…¸ì¶œ -->
    <button class="dev-btn" id="dev-skip-pay-btn" onclick="devSkipPayment()" style="display:none">
      âš¡ [DEV] ê²°ì œ ìŠ¤í‚µí•˜ê³  ë‹¤ìŒìœ¼ë¡œ
    </button>

    <p class="notice">
      í† ìŠ¤í˜ì´ë¨¼ì¸  ë³´ì•ˆ ê²°ì œ Â· ê°œì¸ì •ë³´ëŠ” ì˜ìƒ ì œì‘ì—ë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤<br>
      ê²°ì œ í›„ ì·¨ì†ŒëŠ” ì˜ìƒ ì œì‘ ì‹œì‘ ì „ê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤
    </p>
  </div>
</section>

<!-- ì‚¬ì§„ ì—…ë¡œë“œ -->
<section class="upload-section" id="upload-section">
  <div class="upload-card">
    <!-- ê°œë°œìš© ë°°ë„ˆ -->
    <div class="dev-banner" id="dev-upload-banner" style="display:none">
      âš¡ DEV MODE â€” S3 ì—†ì´ í…ŒìŠ¤íŠ¸ ì¤‘
    </div>

    <h2>ğŸ“¸ ì‚¬ì§„ ì—…ë¡œë“œ</h2>
    <p style="font-size:14px;color:var(--muted);margin-top:4px">ì£¼ë¬¸ë²ˆí˜¸ <span id="order-num-display" style="color:var(--purple);font-weight:600"></span></p>

    <div class="progress-bar">
      <div class="progress-fill" id="upload-progress"></div>
    </div>
    <div style="font-size:13px;color:var(--muted);margin-bottom:16px" id="progress-text">0 / 0 ì—…ë¡œë“œ ì™„ë£Œ</div>

    <div class="upload-drop" id="drop-zone" onclick="document.getElementById('file-input').click()">
      <div style="font-size:40px">ğŸ–¼ï¸</div>
      <p>í´ë¦­í•˜ê±°ë‚˜ ì‚¬ì§„ì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ì„¸ìš”</p>
      <p style="font-size:12px;margin-top:4px">JPG, PNG Â· ìµœëŒ€ <span id="max-photos">12</span>ì¥ Â· ê° 20MB ì´í•˜</p>
    </div>
    <input type="file" id="file-input" accept="image/jpeg,image/png,image/jpg" multiple>
    <div class="file-list" id="file-list"></div>

    <button class="upload-start-btn" id="upload-btn" onclick="startUpload()" disabled>
      ì—…ë¡œë“œ ì‹œì‘í•˜ê¸° (<span id="selected-count">0</span>ì¥ ì„ íƒë¨)
    </button>

    <!-- ê°œë°œìš© ì—…ë¡œë“œ ìŠ¤í‚µ -->
    <button class="dev-btn" id="dev-skip-upload-btn" onclick="devSkipUpload()" style="display:none">
      âš¡ [DEV] ì—…ë¡œë“œ ìŠ¤í‚µí•˜ê³  ì™„ë£Œ í™”ë©´ìœ¼ë¡œ
    </button>
  </div>
</section>

<!-- ì™„ë£Œ -->
<section class="done-section" id="done-section">
  <div class="done-icon">ğŸ‰</div>
  <h2>ì£¼ë¬¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h2>
  <div class="order-number" id="done-order-num"></div>
  <p>24ì‹œê°„ ì´ë‚´ì— ì™„ì„± ì˜ìƒ ë‹¤ìš´ë¡œë“œ ë§í¬ë¥¼<br>ë“±ë¡í•˜ì‹  ì—°ë½ì²˜ë¡œ ë¬¸ì ë°œì†¡í•´ë“œë¦½ë‹ˆë‹¤.<br><br>
    ì†Œì¤‘í•œ ìˆœê°„ì„ ë‹´ì•„ë“œë¦¬ê² ìŠµë‹ˆë‹¤ ğŸ’•</p>
</section>

<footer>
  <p>ê¸°ë…ì¼ ì˜ìƒ ì„œë¹„ìŠ¤ Â· ë¬¸ì˜: ì¹´ì¹´ì˜¤í†¡ ì±„ë„ @ê¸°ë…ì¼ì˜ìƒ</p>
  <p style="margin-top:6px">â“’ 2025 Anniversary Video. All rights reserved.</p>
</footer>

<script>
let PORTONE_STORE_ID = '';
let PORTONE_CHANNEL_KEY = '';
let IS_DEV = false;
let currentOrderId = null;
let presignedUrls = [];
let selectedFiles = [];

function scrollToOrder() {
  document.getElementById('order-section').scrollIntoView({ behavior: 'smooth' });
}

// â”€â”€ DEV ëª¨ë“œ ê°ì§€ â€” localhostì´ë©´ ë°”ë¡œ ë…¸ì¶œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function detectDevMode() {
  IS_DEV = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
  if (IS_DEV) {
    document.getElementById('dev-skip-pay-btn').style.display = 'block';
  }
}

// â”€â”€ ì£¼ë¬¸ ê³µí†µ ìƒì„± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function createOrder() {
  const name       = document.getElementById('customerName').value.trim();
  const phone      = document.getElementById('customerPhone').value.trim();
  const email      = document.getElementById('customerEmail').value.trim();
  const photoCount = parseInt(document.getElementById('photoCount').value);

  let valid = true;
  if (!name) { showError('err-name', 'ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); valid = false; }
  else hideError('err-name');
  if (!/^01[016789]\d{7,8}$/.test(phone)) {
    showError('err-phone', 'ì˜¬ë°”ë¥¸ íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” (ì˜ˆ: 01012345678)');
    valid = false;
  } else hideError('err-phone');
  if (!valid) throw new Error('VALIDATION');

  const resp = await fetch('/api/orders', {
    method:  'POST',
    headers: { 'Content-Type': 'application/json' },
    body:    JSON.stringify({ customerName: name, customerPhone: phone,
                              customerEmail: email || null, photoCount })
  });
  if (!resp.ok) {
    const err = await resp.json().catch(() => ({}));
    throw new Error(err.message || 'ì£¼ë¬¸ ìƒì„± ì‹¤íŒ¨');
  }
  return resp.json();
}

// â”€â”€ ê²°ì œ ì‹œì‘ (ì‹¤ì œ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function startPayment() {
  const btn = document.getElementById('pay-btn');
  btn.disabled = true;
  btn.textContent = 'ì£¼ë¬¸ ìƒì„± ì¤‘...';

  try {
    const orderData   = await createOrder();
    currentOrderId    = orderData.orderId;
    presignedUrls     = orderData.presignedUrls;

    const response = await PortOne.requestPayment({
      storeId:     PORTONE_STORE_ID,
      channelKey:  PORTONE_CHANNEL_KEY,
      paymentId:   String(orderData.orderId),
      orderName:   'í”„ë¦¬ë¯¸ì—„ ê¸°ë…ì¼ ì¸ìƒ ì˜ìƒ',
      totalAmount: orderData.amount,
      currency:    'CURRENCY_KRW',
      payMethod:   'CARD',
      customer: {
        fullName:    document.getElementById('customerName').value.trim(),
        phoneNumber: document.getElementById('customerPhone').value.trim(),
        email:       document.getElementById('customerEmail').value.trim() || 'order@anniversary-video.com',
      },
      redirectUrl: window.location.origin + '/payment/success',
    });
    if (response.code) throw { code: response.code, message: response.message };
  } catch (e) {
    if (e.message !== 'VALIDATION' && e.code !== 'USER_CANCEL') alert('ì˜¤ë¥˜: ' + e.message);
    btn.disabled = false;
    btn.textContent = 'ğŸ’³ ê²°ì œí•˜ê³  ì‚¬ì§„ ì—…ë¡œë“œí•˜ê¸°';
  }
}

// â”€â”€ [DEV] ê²°ì œ ìŠ¤í‚µ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function devSkipPayment() {
  const skipBtn = document.getElementById('dev-skip-pay-btn');
  const payBtn  = document.getElementById('pay-btn');
  skipBtn.disabled = true;
  skipBtn.textContent = 'ì²˜ë¦¬ ì¤‘...';
  payBtn.disabled = true;

  try {
    const orderData = await createOrder();
    currentOrderId  = orderData.orderId;

    // ê²°ì œ ìŠ¤í‚µ API
    const skipResp = await fetch(`/api/dev/orders/${currentOrderId}/skip-payment`, {
      method: 'POST'
    });
    if (!skipResp.ok) throw new Error('ê²°ì œ ìŠ¤í‚µ ì‹¤íŒ¨');

    // presignedUrls ì¬ë°œê¸‰ (S3 ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´ë¡œ ì˜¤ì§€ë§Œ í™”ë©´ì€ ë³´ì„)
    try {
      const urlResp = await fetch(`/api/orders/${currentOrderId}/upload-urls`);
      const urlData = await urlResp.json();
      presignedUrls = urlData.presignedUrls || [];
    } catch { presignedUrls = []; }

    showUploadSection(currentOrderId, true);

  } catch (e) {
    if (e.message !== 'VALIDATION') alert('ì˜¤ë¥˜: ' + e.message);
    skipBtn.disabled = false;
    skipBtn.textContent = 'âš¡ [DEV] ê²°ì œ ìŠ¤í‚µí•˜ê³  ë‹¤ìŒìœ¼ë¡œ';
    payBtn.disabled = false;
  }
}

// â”€â”€ [DEV] ì—…ë¡œë“œ ìŠ¤í‚µ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function devSkipUpload() {
  const btn = document.getElementById('dev-skip-upload-btn');
  btn.disabled = true;
  btn.textContent = 'ì²˜ë¦¬ ì¤‘...';

  try {
    const resp = await fetch(`/api/dev/orders/${currentOrderId}/skip-upload`, {
      method: 'POST'
    });
    if (!resp.ok) {
      const err = await resp.json().catch(() => ({}));
      throw new Error(err.message || 'ì—…ë¡œë“œ ìŠ¤í‚µ ì‹¤íŒ¨');
    }
    const data = await resp.json();
    console.log('[DEV] ì—…ë¡œë“œ ìŠ¤í‚µ:', data);
    showDone();
  } catch (e) {
    alert('ì˜¤ë¥˜: ' + e.message);
    btn.disabled = false;
    btn.textContent = 'âš¡ [DEV] ì—…ë¡œë“œ ìŠ¤í‚µí•˜ê³  ì™„ë£Œ í™”ë©´ìœ¼ë¡œ';
  }
}

// â”€â”€ ê²°ì œ ì„±ê³µ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²˜ë¦¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function handlePaymentSuccess() {
  const params    = new URLSearchParams(window.location.search);
  const paymentId = params.get('paymentId');
  const orderId   = params.get('orderId') || params.get('payment_id');  // í¬íŠ¸ì› ë¦¬ë‹¤ì´ë ‰íŠ¸ íŒŒë¼ë¯¸í„°
  if (!paymentId && !orderId) return;

  hideMainSections();
  const loadingDiv = showLoading('ê²°ì œ ì²˜ë¦¬ ì¤‘...');

  // orderId = paymentId ë¡œ ì„¤ì •í–ˆìœ¼ë¯€ë¡œ paymentIdëŠ” orderIdì™€ ë™ì¼
  const resolvedPaymentId = paymentId || orderId;
  const resolvedOrderId   = orderId   || paymentId;

  try {
    const confirmResp = await fetch('/api/payments/confirm', {
      method:  'POST',
      headers: { 'Content-Type': 'application/json' },
      body:    JSON.stringify({ paymentId: resolvedPaymentId, orderId: resolvedOrderId, amount: 29900 })
    });
    if (!confirmResp.ok) {
      const err = await confirmResp.json().catch(() => ({}));
      throw new Error(err.message || 'ê²°ì œ ìŠ¹ì¸ ì‹¤íŒ¨');
    }

    currentOrderId = parseInt(orderId);
    const urlResp  = await fetch('/api/orders/' + orderId + '/upload-urls');
    if (!urlResp.ok) throw new Error('ì—…ë¡œë“œ URL ë°œê¸‰ ì‹¤íŒ¨');
    const urlData  = await urlResp.json();
    presignedUrls  = urlData.presignedUrls || [];

    loadingDiv.remove();
    showUploadSection(orderId, false);

  } catch (e) {
    loadingDiv.innerHTML = `
      <div style="font-size:48px">âŒ</div>
      <div style="font-size:18px;font-weight:700">ê²°ì œ ì²˜ë¦¬ ì˜¤ë¥˜</div>
      <div style="font-size:14px;color:#f87171;margin-top:8px">${e.message}</div>
      <div style="font-size:13px;color:#64748b;margin-top:12px">ì£¼ë¬¸ë²ˆí˜¸: #${orderId}<br>ë¬¸ì˜: ì¹´ì¹´ì˜¤í†¡ @ê¸°ë…ì¼ì˜ìƒ</div>
      <a href="/" style="margin-top:20px;padding:10px 28px;background:#7c3aed;color:#fff;border-radius:8px;text-decoration:none;font-weight:600">ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>`;
  }
}

// â”€â”€ ì—…ë¡œë“œ í™”ë©´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showUploadSection(orderId, devMode) {
  hideMainSections();
  document.getElementById('upload-section').style.display = 'block';
  document.getElementById('order-num-display').textContent = '#' + orderId;
  document.getElementById('max-photos').textContent = presignedUrls.length || 15;

  if (devMode) {
    document.getElementById('dev-upload-banner').style.display = 'block';
    document.getElementById('dev-skip-upload-btn').style.display = 'block';
    // S3 ì—†ìœ¼ë©´ ì‹¤ì œ ì—…ë¡œë“œ ë²„íŠ¼ ë¹„í™œì„±í™” ìœ ì§€ (ì„ íƒì€ ê°€ëŠ¥í•˜ê²Œ ë‘ë˜ ìŠ¤í‚µ ë²„íŠ¼ ìœ ë„)
  }

  window.scrollTo({ top: 0, behavior: 'smooth' });

  const drop = document.getElementById('drop-zone');
  drop.addEventListener('dragover', e => { e.preventDefault(); drop.classList.add('drag-over'); });
  drop.addEventListener('dragleave', () => drop.classList.remove('drag-over'));
  drop.addEventListener('drop', e => {
    e.preventDefault(); drop.classList.remove('drag-over');
    handleFiles(Array.from(e.dataTransfer.files));
  });
  document.getElementById('file-input').addEventListener('change', e => {
    handleFiles(Array.from(e.target.files));
  });
}

function handleFiles(files) {
  const maxCount = presignedUrls.length || 15;
  selectedFiles  = files.filter(f => f.type.startsWith('image/')).slice(0, maxCount);
  renderFileList();
  document.getElementById('selected-count').textContent = selectedFiles.length;
  // DEV ëª¨ë“œì—ì„œ S3 ì—†ìœ¼ë©´ ì‹¤ì œ ì—…ë¡œë“œ ë²„íŠ¼ ë¹„í™œì„±
  if (!IS_DEV) {
    document.getElementById('upload-btn').disabled = selectedFiles.length === 0;
  }
}

function renderFileList() {
  document.getElementById('file-list').innerHTML = selectedFiles.map((f, i) => `
    <div class="file-item" id="file-item-${i}">
      <span>ğŸ“„</span>
      <span class="file-name">${f.name}</span>
      <span style="font-size:12px;color:var(--muted)">${(f.size/1024/1024).toFixed(1)}MB</span>
      <span class="file-status" id="file-status-${i}">ëŒ€ê¸°</span>
    </div>
  `).join('');
}

// â”€â”€ S3 ì—…ë¡œë“œ + ì™„ë£Œ ì‹ ê³  (ì‹¤ì œ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function startUpload() {
  if (selectedFiles.length === 0) return;

  const btn = document.getElementById('upload-btn');
  btn.disabled = true;
  btn.textContent = 'ì—…ë¡œë“œ ì¤‘...';

  let uploaded = 0;
  const total  = selectedFiles.length;
  const succeededKeys = [];

  for (let i = 0; i < selectedFiles.length; i++) {
    const file    = selectedFiles[i];
    const urlInfo = presignedUrls[i];
    setFileStatus(i, 'uploading', 'ì—…ë¡œë“œ ì¤‘...');

    try {
      const resp = await fetch(urlInfo.uploadUrl, {
        method:  'PUT',
        headers: { 'Content-Type': 'image/jpeg' },
        body:    file
      });
      if (!resp.ok) throw new Error('S3 PUT ì‹¤íŒ¨');
      succeededKeys.push(urlInfo.s3Key);
      uploaded++;
      setFileStatus(i, 'done', 'âœ“ ì™„ë£Œ');
    } catch {
      setFileStatus(i, 'error', 'âœ— ì‹¤íŒ¨');
    }

    const pct = Math.round((uploaded / total) * 100);
    document.getElementById('upload-progress').style.width = pct + '%';
    document.getElementById('progress-text').textContent   = `${uploaded} / ${total} ì—…ë¡œë“œ ì™„ë£Œ`;
  }

  if (uploaded === total) {
    try {
      await fetch('/api/orders/' + currentOrderId + '/upload-complete', {
        method:  'POST',
        headers: { 'Content-Type': 'application/json' },
        body:    JSON.stringify({ s3Keys: succeededKeys })
      });
    } catch (e) { console.error('upload-complete ì˜¤ë¥˜:', e); }
    setTimeout(() => showDone(), 800);
  } else {
    btn.disabled = false;
    btn.textContent = 'ì‹¤íŒ¨í•œ íŒŒì¼ ì¬ì‹œë„';
  }
}

function setFileStatus(i, cls, text) {
  const el = document.getElementById('file-status-' + i);
  if (el) { el.className = 'file-status ' + cls; el.textContent = text; }
}

function showDone() {
  document.getElementById('upload-section').style.display = 'none';
  document.getElementById('done-section').style.display   = 'block';
  document.getElementById('done-order-num').textContent   = 'ì£¼ë¬¸ë²ˆí˜¸ #' + currentOrderId;
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// â”€â”€ SMS resume â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function handleResume(orderId) {
  hideMainSections();
  const loadingDiv = showLoading('ì£¼ë¬¸ ì •ë³´ í™•ì¸ ì¤‘...');
  try {
    const statusResp = await fetch('/api/orders/' + orderId + '/status');
    if (!statusResp.ok) throw new Error('ì£¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    const statusData = await statusResp.json();

    if (statusData.status === 'PROCESSING' || statusData.status === 'COMPLETED') {
      loadingDiv.innerHTML = '<div style="font-size:48px">ğŸ¬</div>' +
        '<div style="font-size:18px;font-weight:700;margin-top:12px">ì˜ìƒ ì œì‘ ì¤‘ì…ë‹ˆë‹¤!</div>' +
        '<div style="color:#94a3b8;margin-top:8px;font-size:14px">24ì‹œê°„ ì´ë‚´ ì™„ì„± í›„ ë¬¸ìë¡œ ì•ˆë‚´ë“œë¦´ê²Œìš”.</div>';
      return;
    }
    if (statusData.status !== 'PAID') {
      loadingDiv.innerHTML = '<div style="font-size:40px">âš ï¸</div>' +
        '<div style="margin-top:12px">ì—…ë¡œë“œí•  ìˆ˜ ì—†ëŠ” ì£¼ë¬¸ ìƒíƒœì…ë‹ˆë‹¤ (' + statusData.status + ')</div>';
      return;
    }

    const urlResp  = await fetch('/api/orders/' + orderId + '/upload-urls');
    if (!urlResp.ok) throw new Error('ì—…ë¡œë“œ URL ë°œê¸‰ ì‹¤íŒ¨');
    presignedUrls  = (await urlResp.json()).presignedUrls || [];
    currentOrderId = parseInt(orderId);
    loadingDiv.remove();
    showUploadSection(orderId, false);
  } catch (e) {
    loadingDiv.innerHTML = '<div style="font-size:40px">âŒ</div><div style="margin-top:12px">' + e.message + '</div>' +
      '<a href="/" style="margin-top:16px;padding:10px 24px;background:#7c3aed;color:#fff;border-radius:8px;text-decoration:none;display:inline-block;margin-top:16px">ì²˜ìŒìœ¼ë¡œ</a>';
  }
}

// â”€â”€ ìœ í‹¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function hideMainSections() {
  document.querySelector('.hero')          && (document.querySelector('.hero').style.display          = 'none');
  document.querySelector('.features')      && (document.querySelector('.features').style.display      = 'none');
  document.querySelector('.process')       && (document.querySelector('.process').style.display       = 'none');
  document.getElementById('order-section') && (document.getElementById('order-section').style.display = 'none');
}

function showLoading(msg) {
  const div = document.createElement('div');
  div.style.cssText = 'display:flex;flex-direction:column;align-items:center;justify-content:center;padding:120px 20px;text-align:center;gap:16px';
  div.innerHTML = `<div style="font-size:48px">â³</div><div style="font-size:20px;font-weight:700">${msg}</div><div style="font-size:14px;color:#64748b">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div>`;
  document.body.insertBefore(div, document.querySelector('footer'));
  return div;
}

function showError(id, msg) { const el = document.getElementById(id); el.textContent = msg; el.style.display = 'block'; }
function hideError(id)      { document.getElementById(id).style.display = 'none'; }

// â”€â”€ DOMContentLoaded â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('DOMContentLoaded', async () => {
  // DEV ëª¨ë“œ ê°ì§€ (ë™ê¸°)
  detectDevMode();

  // í¬íŠ¸ì› ì„¤ì • ë¡œë“œ
  try {
    const cfg = await fetch('/api/orders/payment-config').then(r => r.json());
    PORTONE_STORE_ID   = cfg.storeId;
    PORTONE_CHANNEL_KEY = cfg.channelKey;
  } catch(e) { console.error('í¬íŠ¸ì› ì„¤ì • ë¡œë“œ ì‹¤íŒ¨', e); }

  if (window.location.pathname === '/payment/success') {
    handlePaymentSuccess();
  } else if (window.location.pathname === '/payment/fail') {
    const params = new URLSearchParams(window.location.search);
    alert('ê²°ì œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤: ' + (params.get('message') || ''));
    window.location.href = '/';
  }

  const resumeId = new URLSearchParams(window.location.search).get('resume');
  if (resumeId) handleResume(resumeId);
});
</script>
</body>
</html>
